# TiddlyWiki Manager v2.3.0 Release Notes

## 🎯 版本信息

- **版本号**: 2.3.0
- **发布日期**: 2025-10-27
- **类型**: Bug 修复与功能增强

## ✨ 主要更新

### 1. 修复关闭窗口时进程未停止的严重 Bug ⭐

**问题描述**: v2.2.0 中，关闭 Wiki 窗口时，窗口关闭但 Wiki 服务器进程仍在运行，导致端口被占用

**解决方案**:

- 关闭窗口时询问用户是否同时停止 Wiki 服务器
- 用户可选择仅关闭窗口或同时停止服务器
- 自动刷新 Wiki 列表状态

**影响**: 彻底解决进程泄漏问题，避免端口被无效占用

### 2. 添加浏览器打开选项 ✅

**新功能**:

- 保留 v2.2.0 的应用内窗口功能
- 新增直接在浏览器中打开的选项
- 用户可根据需求选择打开方式

**UI 改进**:

- "应用内"按钮 - 在应用内窗口中打开
- "浏览器"按钮 - 在系统默认浏览器中打开
- 两个按钮并列显示，选择更灵活

### 3. 按分类/标签分组显示 (Details 折叠) ⭐⭐⭐

**问题描述**: v2.2.0 中，按分类或标签筛选时，仅改变顺序，没有明显的分组区分

**新功能**:

- 使用 `<details>` 元素实现可折叠的分组
- 按分类显示时，每个分类单独一组
- 按标签显示时，每个标签单独一组
- 显示每组中的 Wiki 数量
- 可以展开/折叠每个分组
- "展开全部"和"折叠全部"快捷按钮

**视觉效果**:

- 清晰的分组边框和背景
- 折叠箭头动画效果
- 悬停高亮显示
- 分组标题加粗显示数量

### 4. 简单和高级筛选页面 ⭐

**简单筛选**:

- 快速筛选界面
- 搜索框
- 分类下拉选择
- 标签快速选择
- 一键切换到高级筛选

**高级筛选**:

- 保留原有的完整筛选功能
- 更多筛选选项
- 详细的筛选条件设置

**使用方式**:

- 第一个筛选按钮 - 打开简单筛选
- 第二个筛选按钮 - 打开高级筛选
- 简单筛选中可切换到高级筛选

### 5. 筛选记录保存 ✅

**新功能**:

- 自动保存最近 10 条筛选记录
- 使用 localStorage 持久化保存
- 筛选记录包含标签、分类和搜索关键词
- 去重功能，避免重复记录

## 🐛 Bug 修复

### 1. Wiki 窗口关闭不停止进程 ⭐

**修复**: 关闭窗口时提示用户选择是否停止服务器

### 2. 分类/标签筛选不明显

**修复**: 使用 details 分组显示，明确区分不同分类和标签

## 🎨 UI/UX 改进

### WikiCard 控制按钮

**原来**:

- 只有一个"打开"按钮

**现在**:

- "应用内"按钮 - 应用内窗口打开
- "浏览器"按钮 - 浏览器打开
- 两个按钮并排显示

### WikiList 分组显示

**新增样式**:

- `.wiki-groups` - 分组容器
- `.wiki-group` - 单个分组
- `.expand-icon` - 折叠箭头
- `.group-title` - 分组标题
- `.group-count` - 分组数量

### 筛选按钮

**新增**:

- 快速筛选按钮（漏斗图标）
- 高级筛选按钮（齿轮图标）
- 清晰区分两种筛选方式

## 🔧 技术实现

### 新增组件

**SimpleFilterPanel.tsx**:

```typescript
interface SimpleFilterPanelProps {
  selectedTags: string[];
  selectedCategory: string;
  searchQuery: string;
  onTagsChange: (tags: string[]) => void;
  onCategoryChange: (category: string) => void;
  onSearchChange: (query: string) => void;
  onClose: () => void;
  allTags: string[];
  allCategories: string[];
  onSwitchToAdvanced: () => void;
}
```

**SimpleFilterPanel.css**:

- 简单筛选界面样式
- 标签按钮样式
- 快捷切换按钮样式

### 修改组件

**WikiList.tsx**:

- 添加 `displayMode` prop
- 实现 `renderByCategory()` - 按分类分组
- 实现 `renderByTag()` - 按标签分组
- 添加展开/折叠状态管理
- "展开全部"和"折叠全部"功能

**WikiCard.tsx**:

- 添加 `handleOpenInBrowser()` 方法
- 修改 UI 显示两个打开按钮

**App.tsx**:

- 添加 `showSimpleFilter` 状态
- 添加 `filterHistory` 状态和持久化
- 修改 `handleCloseWindow` 提示用户
- 传递 `displayMode` 给 WikiList

### CSS 改进

**WikiList.css**:

- `.expand-controls` - 展开/折叠控制
- `.wiki-groups` - 分组容器
- `.wiki-group` - 分组样式
- `.wiki-group summary` - 分组标题
- `.expand-icon` - 折叠箭头动画
- `.group-title` - 标题样式
- `.group-count` - 数量显示

## 📊 版本对比

| 功能          | v2.2.0        | v2.3.0          |
| ------------- | ------------- | --------------- |
| 关闭窗口行为  | ❌ 进程不停止 | ✅ 可选择停止   |
| 打开方式      | 仅应用内      | 应用内+浏览器   |
| 分类/标签显示 | 仅排序        | ✅ 分组折叠显示 |
| 筛选方式      | 仅高级筛选    | 简单+高级筛选   |
| 筛选记录      | 无            | ✅ 自动保存     |
| 分组展开/折叠 | 无            | ✅ 支持         |

## 🚀 使用指南

### 关闭 Wiki 窗口

1. 点击窗口的关闭按钮（X）
2. 系统会询问："是否同时停止 Wiki 服务器？"
3. 选择"确定"- 关闭窗口并停止服务器
4. 选择"取消"- 仅关闭窗口，服务器继续运行

### 打开 Wiki

**应用内打开**:

1. 点击"应用内"按钮
2. Wiki 在应用内的新窗口中打开
3. 可以打开多个 Wiki 窗口

**浏览器打开**:

1. 点击"浏览器"按钮
2. Wiki 在系统默认浏览器中打开
3. 适合需要浏览器功能的场景

### 按分类查看

1. 在显示模式下拉框选择"按分类"
2. Wiki 按分类分组显示
3. 点击分类标题展开/折叠
4. 使用"展开全部"/"折叠全部"批量操作

### 按标签查看

1. 在显示模式下拉框选择"按标签"
2. Wiki 按标签分组显示
3. 每个 Wiki 可能出现在多个标签组中
4. 无标签的 Wiki 显示在"无标签"组中

### 快速筛选

1. 点击第一个筛选按钮（漏斗图标）
2. 使用搜索框、分类选择、标签选择
3. 点击"应用筛选"
4. 可切换到"高级筛选"获取更多选项

### 高级筛选

1. 点击第二个筛选按钮（齿轮图标）
2. 使用完整的筛选功能
3. 包含所有筛选选项

## ⚠️ 注意事项

### 关闭窗口提示

- 每次关闭窗口都会询问
- 建议仅关闭窗口时选择"取消"
- 确定停止服务器时选择"确定"

### 分组显示

- 按标签分组时，一个 Wiki 可能出现在多个组中
- 展开/折叠状态在切换视图后会重置

### 筛选记录

- 最多保存 10 条筛选记录
- 重复的筛选条件不会重复保存
- 筛选记录保存在浏览器 localStorage 中

## 🎊 总结

v2.3.0 是一个重要的 bug 修复和功能增强版本：

- ✅ 修复了关键的进程泄漏 bug
- ✅ 增加了打开方式的灵活性
- ✅ 极大改善了分组显示的用户体验
- ✅ 提供了简单和高级两种筛选方式
- ✅ 自动保存筛选记录

这个版本彻底解决了 v2.2.0 的主要问题，并根据用户反馈进行了大量改进。

---

**发布时间**: 2025-10-27  
**下一版本计划**: v2.4.0 - 窗口状态持久化与批量操作

