# TiddlyWiki Manager v2.2.0 Release Notes

## 🎯 版本信息

- **版本号**: 2.2.0
- **发布日期**: 2025-10-27
- **类型**: 重大功能更新

## ✨ 主要新功能

### 真正的多窗口支持 ⭐⭐⭐

**问题描述**: v2.1.0 版本中，Wiki 在浏览器中打开，无法在软件内部管理多个窗口

**新功能**:

- ✅ **应用内窗口系统** - Wiki 在软件内部的独立窗口中显示
- ✅ **无限制多窗口** - 可以同时打开任意数量的 Wiki
- ✅ **完整窗口控制**:
  - 最小化/最大化/关闭按钮
  - 拖动调整位置
  - 调整窗口大小
  - 双击标题栏最大化
  - Z-Index 管理（点击聚焦）
- ✅ **最小化任务栏** - 底部任务栏显示所有最小化的窗口
- ✅ **独立 iframe** - 每个窗口使用独立的 iframe 加载 Wiki

## 🎨 用户界面

### Wiki 窗口特性

**窗口控制**:

- 最小化按钮 - 隐藏窗口到任务栏
- 最大化按钮 - 全屏显示 Wiki
- 关闭按钮 - 关闭 Wiki 窗口（不停止服务器）

**窗口交互**:

- 拖动标题栏移动窗口
- 拖动右下角调整大小
- 点击窗口聚焦（提升 z-index）
- 最大化时禁用拖动和调整大小

**任务栏**:

- 自动显示/隐藏
- 显示所有最小化窗口
- 点击恢复窗口
- 窗口标题显示

## 🔧 技术实现

### 新增组件

**WikiWindow.tsx**:

```typescript
interface WikiWindowProps {
  id: string;
  title: string;
  url: string;
  onClose: () => void;
  onMinimize: () => void;
  zIndex: number;
  onFocus: () => void;
}
```

功能:

- 窗口拖动逻辑
- 窗口调整大小逻辑
- iframe 加载 Wiki
- 窗口状态管理

**WikiWindow.css**:

- 窗口样式
- 标题栏样式
- 控制按钮样式
- 调整大小手柄样式

### 修改组件

**App.tsx**:

- 添加 `openWindows` 状态管理
- 添加 `nextZIndex` 用于窗口层级
- 添加窗口管理函数:
  - `handleOpenWiki()` - 打开新窗口
  - `handleCloseWindow()` - 关闭窗口
  - `handleMinimizeWindow()` - 最小化/恢复窗口
  - `handleFocusWindow()` - 聚焦窗口
- 渲染 WikiWindow 组件
- 渲染最小化任务栏

**WikiList.tsx & WikiCard.tsx**:

- 添加 `onOpenWiki` 回调
- 修改打开逻辑调用 `onOpenWiki` 而不是 `BrowserOpenURL`

**App.css**:

- 添加 `.minimized-taskbar` 样式
- 添加 `.minimized-window-btn` 样式

## 📊 版本对比

| 功能               | v2.1.0     | v2.2.0       |
| ------------------ | ---------- | ------------ |
| Wiki 打开方式      | 浏览器     | 应用内窗口   |
| 窗口管理           | 浏览器标签 | 软件内部管理 |
| 同时打开 Wiki 数量 | 无限制     | 无限制       |
| 窗口控制           | 浏览器控制 | 完整窗口控制 |
| 最小化功能         | 无         | ✅ 任务栏    |
| 拖动窗口           | 无         | ✅ 支持      |
| 调整大小           | 无         | ✅ 支持      |
| 聚焦管理           | 无         | ✅ Z-Index   |

## 🚀 使用指南

### 打开 Wiki 窗口

1. 确保 Wiki 已启动（状态显示"运行中"）
2. 点击 Wiki 卡片上的"打开"按钮
3. Wiki 将在应用内的新窗口中打开
4. 可以继续打开更多 Wiki，没有数量限制

### 管理窗口

**移动窗口**:

- 拖动标题栏到任意位置
- 窗口会记住位置（在当前会话中）

**调整大小**:

- 拖动右下角的调整手柄
- 最小尺寸：400x300 像素

**最大化/还原**:

- 点击最大化按钮
- 或双击标题栏

**最小化**:

- 点击最小化按钮
- 窗口会隐藏到底部任务栏
- 点击任务栏中的窗口按钮恢复

**关闭窗口**:

- 点击关闭按钮
- 窗口关闭但 Wiki 服务器继续运行
- 可以随时重新打开

### 窗口聚焦

- 点击任意窗口会自动聚焦
- 聚焦的窗口会显示在最前面
- 使用 z-index 管理层级

## ⚠️ 注意事项

### 窗口管理

- 窗口位置和大小在刷新后会重置
- 最小化窗口在应用关闭后不会保留
- 每次打开 Wiki 都会创建新窗口（即使之前已打开）

### 性能

- 同时打开多个窗口会占用更多内存
- 建议根据系统性能合理控制窗口数量
- 每个窗口都有独立的 iframe 和 Wiki 实例

### 兼容性

- iframe 使用 sandbox 属性保证安全
- 支持所有 TiddlyWiki 功能
- 窗口在应用内完全独立

## 🎊 总结

v2.2.0 是一个重大更新，实现了真正的应用内多窗口系统：

- ✅ 满足用户在软件内打开 Wiki 的需求
- ✅ 提供完整的窗口管理功能
- ✅ 支持无限制数量的 Wiki 同时打开
- ✅ 优雅的用户界面和交互体验
- ✅ 独立的窗口系统，互不干扰

这个版本彻底解决了 v2.1.0 中 Wiki 在浏览器打开的问题，提供了真正的桌面应用体验。

---

**发布时间**: 2025-10-27  
**下一版本计划**: v2.3.0 - 窗口状态持久化与性能优化


