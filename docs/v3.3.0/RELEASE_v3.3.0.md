# TiddlyWiki Manager v3.3.0 发布说明

发布日期：2025-10-29

## 🐛 问题修复

### 1. 筛选功能修复

- **修复分类筛选失效问题**：统一使用 `__NONE__` 标识符处理"未分类"和"无标签"的筛选
- **修复标签筛选失效问题**：确保筛选按钮点击后正确传递筛选条件
- **改进筛选逻辑**：修正 FilterPanel2 和 App 主组件之间的数据传递

### 2. 文件选择器修复

- **修复选择文件夹导致应用退出的问题**：
  - 添加 panic 恢复机制
  - 改进错误处理逻辑
  - 正确处理用户取消选择的情况
  - 避免在用户取消时显示错误提示

### 3. 详细修复内容

#### 前端修复 (App.tsx)

```typescript
// 修复前：使用中文字符串判断
if (selectedCategory === "无分类") { ... }
if (selectedTags.includes("无标签")) { ... }

// 修复后：使用统一标识符
if (selectedCategory === "__NONE__") { ... }
if (selectedTags.includes("__NONE__")) { ... }
```

#### 后端修复 (app.go)

```go
// 添加 panic 恢复
defer func() {
    if r := recover(); r != nil {
        services.LogError("SelectFolder panic", fmt.Errorf("%v", r))
    }
}()

// 正确处理用户取消
if err != nil && err.Error() == "User cancelled" {
    return "", nil
}

// 处理空路径
if path == "" {
    return "", nil
}
```

#### 前端组件修复 (WikiForm.tsx)

```typescript
// 改进错误处理，不显示取消操作的错误
if (error && !error.toString().includes("cancel")) {
  alert("选择文件夹失败: " + error);
}
```

## 📋 测试建议

1. **筛选功能测试**：

   - 在筛选面板中选择"未分类"分类，验证筛选结果正确
   - 在筛选面板中选择"无标签"标签，验证筛选结果正确
   - 同时使用分类和标签筛选，验证组合筛选功能
   - 在快速筛选和高级筛选之间切换，验证筛选条件保持

2. **文件选择器测试**：
   - 在"添加 Wiki"表单中点击"选择文件夹"按钮
   - 在文件夹选择对话框中点击"取消"，确认应用不会退出
   - 在文件夹选择对话框中选择一个文件夹，确认路径正确填入
   - 在"创建新 Wiki"表单中测试相同的文件夹选择功能

## 🔧 技术改进

- 统一使用 `__NONE__` 作为特殊标识符，区分正常的用户输入和系统标识
- 增强错误处理和日志记录
- 改进用户体验，避免不必要的错误提示

## 📦 安装说明

1. 下载 `TiddlyWiki-Manager-win64-v3.3.0.exe`
2. 双击运行（可能需要管理员权限）
3. 如有之前版本，建议先关闭旧版本再运行新版本

## 🔄 从旧版本升级

- 配置文件完全兼容，无需任何迁移操作
- 直接覆盖旧版本即可

## 📝 版本信息

- 版本号：v3.3.0
- 构建日期：2025-10-29
- Wails 版本：v2.10.2
- Go 版本：1.x
- 前端框架：React + TypeScript + Vite

## 🙏 致谢

感谢所有用户的反馈和建议！

---

上一版本：[v3.2.0](../v3.2.0/RELEASE_v3.2.0.md)
