# TiddlyWiki Manager v2.9.0 发布说明

## 🎉 版本概览

v2.9.0 是一个关键的 **Bug 修复** 和 **体验优化** 版本，专注于解决核心问题，提升软件稳定性和可用性。

**发布日期**: 2025-10-29

---

## 🔥 核心修复

### 1. ✅ 彻底修复进程关闭问题

**这是本版本最重要的修复！**

#### 问题描述

之前版本中，无论是点击窗口关闭还是停止按钮，TiddlyWiki 进程都无法真正终止，导致：

- 端口持续被占用
- 系统资源浪费
- 无法重新启动同一 Wiki

#### 解决方案

使用 **Windows taskkill 命令强制终止进程树**：

```go
// 使用 taskkill /F /T /PID 强制终止进程及其所有子进程
killCmd := exec.Command("taskkill", "/F", "/T", "/PID", fmt.Sprintf("%d", cmd.Process.Pid))
```

#### 技术细节

- **`/F`**: 强制终止进程
- **`/T`**: 终止进程树（包括所有子进程）
- **`/PID`**: 指定进程 ID

这确保了：

1. ✅ 主进程被终止
2. ✅ 所有子进程被终止
3. ✅ 端口立即释放
4. ✅ 资源完全清理

**现在关闭窗口或点击停止，进程将彻底终止！**

---

## ✨ 重大改进

### 2. ✅ 表格视图完全重写

#### 改进前的问题

- 描述列占用太多空间
- 按钮挤在一起
- 表格太宽需要横向滚动
- 几乎无法使用

#### 改进后

- ✅ **移除描述列**：为操作按钮腾出空间
- ✅ **固定列宽**：使用 `table-layout: fixed` 确保列宽合理
- ✅ **优化列宽分配**：
  - 名称: 15%
  - 状态: 8%
  - 端口: 6%
  - 分类: 10%
  - 标签: 12%
  - 路径: 25%
  - 操作: 24%
- ✅ **所有按钮清晰可见**：7 个操作按钮整齐排列
- ✅ **按钮居中对齐**：更加美观

**现在表格视图真正可用了！**

### 3. ✅ 筛选视图优化

#### 改进内容

- ✅ **去掉滚动条**：整个筛选面板作为一个整体显示
- ✅ **固定高度**：`height: calc(100vh - 220px)`
- ✅ **内容不溢出**：`overflow: visible`
- ✅ **统一设计**：与整体界面风格一致

**筛选视图现在更加简洁统一！**

### 4. ✅ 信息面板增强

#### 新增内容

添加了 **GitHub 仓库链接**：

```tsx
<div className="info-section">
  <h3>🔗 开源项目</h3>
  <div className="info-item">
    <span className="info-label">GitHub 仓库:</span>
    <a
      href="https://github.com/dongrentianyu/TiddlyWiki-Go"
      target="_blank">
      dongrentianyu/TiddlyWiki-Go
    </a>
  </div>
</div>
```

#### 特性

- ✅ 点击直接跳转到 GitHub
- ✅ 在新标签页打开
- ✅ 美观的链接样式
- ✅ Hover 效果

**现在用户可以直接访问项目仓库！**

### 5. ✅ 导出 HTML 优化

#### 改进前

导出后会保留两个文件：

- `index.html`（原文件）
- `index-2025-10-29-17_27.html`（时间戳版本）

#### 改进后

**只保留时间戳版本**：

```go
// 直接重命名文件，删除原文件
if err := os.Rename(originalPath, newPath); err != nil {
    return "", fmt.Errorf("重命名文件失败: %w", err)
}
```

#### 优点

- ✅ 文件管理更清晰
- ✅ 避免混淆
- ✅ 节省磁盘空间
- ✅ 每次导出都是独立的文件

**现在导出文件夹更整洁！**

---

## 📋 完整更新列表

| 更新项目          | 状态 | 说明                           |
| ----------------- | ---- | ------------------------------ |
| 1. 进程关闭问题   | ✅   | 使用 taskkill 强制终止进程树   |
| 2. 表格视图重写   | ✅   | 移除描述列，优化列宽，按钮居中 |
| 3. 筛选视图优化   | ✅   | 去掉滚动条，保持为整体         |
| 4. GitHub 链接    | ✅   | 信息面板添加仓库链接           |
| 5. 导出 HTML 优化 | ✅   | 只保留时间戳版本，删除原文件   |

---

## 🔧 技术改进

### 后端改进

1. **进程管理增强** (`services/process_service.go`)

   ```go
   // Stop 函数
   - 添加 PID 日志记录
   - 使用 taskkill 命令
   - 双重保险：taskkill 失败时回退到 Process.Kill()
   - 详细的错误日志
   ```

2. **导出功能优化**
   ```go
   // ExportWikiToHTML 函数
   - 使用 os.Rename() 替代 copyFile()
   - 删除了 copyFile() 函数
   - 移除了 io 包依赖
   ```

### 前端改进

1. **表格组件优化** (`WikiTable.tsx/css`)

   - 移除描述列
   - 添加列宽类名
   - 优化按钮样式
   - 改进路径复制提示

2. **筛选组件优化** (`FilterPanel2.css`)

   - 固定面板高度
   - 移除滚动条
   - Flexbox 布局

3. **信息组件增强** (`InfoPanel.tsx/css`)
   - 添加 GitHub 链接
   - 新增链接样式

---

## 📦 构建信息

**文件名**: `TiddlyWiki-Manager-win64-v2.9.0.exe`  
**位置**: `build\bin\`  
**版本**: v2.9.0  
**构建日期**: 2025-10-29  
**大小**: ~10.3 MB

---

## 🔄 升级说明

### 从任意版本升级到 v2.9.0

1. **下载新版本**

   - `TiddlyWiki-Manager-win64-v2.9.0.exe`

2. **关闭旧版本**

   - 退出应用程序
   - **重要**：如果有 Wiki 正在运行，请先停止

3. **替换文件**

   - 用新版本替换旧版本

4. **启动新版本**

   - 所有数据和配置自动保留

5. **验证进程管理**
   - 启动一个 Wiki
   - 关闭其窗口
   - 打开任务管理器确认进程已终止
   - 检查端口已释放

---

## 💡 使用提示

### 验证进程关闭功能

1. 启动一个 Wiki
2. 打开任务管理器（Ctrl+Shift+Esc）
3. 找到 `tiddlywiki` 进程
4. 在应用中关闭 Wiki 窗口
5. 在任务管理器中确认进程消失

### 表格视图使用

1. 点击 **≡** 图标切换到表格视图
2. 所有操作按钮在最右侧清晰可见
3. 点击列标题可排序
4. 路径列显示完整路径，点击 📋 复制

### 导出 HTML

1. 点击 📄 按钮导出
2. 文件名格式：`index-2025-10-29-17_41.html`
3. 只保留时间戳版本
4. 原 `index.html` 被重命名

---

## 🐛 已知问题

**无已知严重问题**

如果发现任何问题，请访问 GitHub 提交 Issue：
https://github.com/dongrentianyu/TiddlyWiki-Go/issues

---

## 🎯 下一步计划

1. 筛选方案历史保存
2. 批量操作功能
3. Wiki 模板管理
4. 性能优化

---

## 🙏 致谢

感谢所有用户的耐心和反馈！特别感谢指出进程关闭问题的用户，这帮助我们解决了这个关键问题。

---

## 📝 相关链接

- **GitHub 仓库**: https://github.com/dongrentianyu/TiddlyWiki-Go
- **TiddlyWiki 官网**: https://tiddlywiki.com/
- **问题反馈**: https://github.com/dongrentianyu/TiddlyWiki-Go/issues

---

**TiddlyWiki Manager v2.9.0 - 稳定可靠的 Wiki 管理工具！**
